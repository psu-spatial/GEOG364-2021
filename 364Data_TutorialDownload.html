<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Project: Downloading data</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="site_libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script src="site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.0.4.1/leaflet-providers-plugin.js"></script>
<script src="site_libs/clipboard-0.0.1/setClipboardText.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">GEOG-364</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pg_Tut1_about.html">1. About R, R-Studio &amp; R-Studio Cloud</a>
    </li>
    <li>
      <a href="pg_Tut2_startup.html">2. Getting started</a>
    </li>
    <li>
      <a href="pg_Tut3_basics.html">3. Console Basics</a>
    </li>
    <li>
      <a href="pg_Tut4_markdown.html">4. Markdown</a>
    </li>
    <li>
      <a href="pg_Tut5_checklist.html">5. Lab Template</a>
    </li>
    <li>
      <a href="pg_Tut6_input_output.html">6. Reading in/saving data</a>
    </li>
    <li>
      <a href="pg_Tut7_wrangle.html">7. Data wrangling</a>
    </li>
    <li>
      <a href="pg_Tut8_summarystat.html">8. Exploratory Data Analysis</a>
    </li>
    <li>
      <a href="pg_Tut9_dist_stats.html">9. Distributions &amp; Inferential Stats</a>
    </li>
    <li>
      <a href="pg_Tut10_plot.html">10. Plotting non-spatial data</a>
    </li>
    <li>
      <a href="pg_Tut11_spatial101.html">11. Spatial data analysis</a>
    </li>
    <li>
      <a href="pg_Tut12_pointpattern.html">12. Point Pattern analysis</a>
    </li>
    <li>
      <a href="pg_Tut13_coding.html">13. Coding</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Labs
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="pg_364Lab1_Basics_2021.html">Lab 1: R-Basics</a>
    </li>
    <li>
      <a href="pg_364Lab2_Summary_2021.html">Lab 2: Playing with data</a>
    </li>
    <li>
      <a href="pg_364Lab3_Spatial_2021.html">Lab 3: Spatial</a>
    </li>
    <li>
      <a href="pg_364Lab4_Manip_2021.html">Lab 4: Spatial Intermediate</a>
    </li>
    <li>
      <a href="pg_364Lab5_tobler_2021.html">Lab 5: Join Counts</a>
    </li>
    <li>
      <a href="pg_364Lab6_moran_2021.html">Lab 6: Census Moran</a>
    </li>
    <li>
      <a href="pg_364Lab7_Regression_2021.html">Lab 7: LISA and Regression</a>
    </li>
    <li>
      <a href="pg_364Lab8_PointPattern_2021.html">Lab 8: Point Pattern</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    PROJECT
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="364Data_TutorialDownload.html">Downloading Secondary datasets</a>
    </li>
    <li>
      <a href="364Data_TutorialWranglePoint.html">Dealing with Point Data</a>
    </li>
    <li>
      <a href="364Data_TutorialWranglePolygon.html">Dealing with Polygon Data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Project: Downloading data</h1>
<h3 class="subtitle"><h4 style="font-style:normal">
GEOG-364 - Spatial Analysis
</h4></h3>

</div>


<style>
p.comment {
background-color: #DBDBDB;
padding: 10px;
border: 1px solid black;
margin-left: 0px;
border-radius: 5px;
font-style: normal;
}

h1.title {
  font-weight: bold;
  font-family: Arial;  
}

h2.title {
  font-family: Arial;  
}

</style>
<style type="text/css">
#TOC {
  font-size: 11px;
  font-family: Arial;
}
</style>
<div id="set-up-and-libraries" class="section level2">
<h2>Set up and libraries</h2>
<p>My example tutorial is set in Iowa. First, I will download two data-sets, a point dataset on farmers markets, and the Iowan SVI data. I then merge in other data-sets.</p>
<pre class="r"><code>library(sp)
library(sf)
library(elevatr)
library(USAboundaries)
library(raster)
library(tidycensus)
library(rnaturalearth)
library(tmap)
library(exactextractr)
library(units)
library(readxl)
library(FedData)</code></pre>
</div>
<div id="csv-and-xlsx-data" class="section level2">
<h2>CSV and XLSX data</h2>
<div id="all-xlsx-and-csv-files" class="section level3">
<h3>All xlsx and csv files</h3>
<p>Make sure that <code>library(readxl)</code> , <code>library(sp)</code> and <code>library(sf)</code> are in your library code chunk at the top.</p>
<p>Some point data might be stored in Shapefile format. If so, load directly as an sf variable using the next tutorial.</p>
<p>Other point data is stored as a csv, a text file or as an excel file.</p>
<p>To read this data in, see <a href="https://psu-spatial.github.io/Geog364-2021/pg_Tut6_input_output.html#Tutorial_6A:_Reading_in_Excel_Files">Tutorial 6a</a> and <a href="https://psu-spatial.github.io/Geog364-2021/pg_Tut6_input_output.html#Tutorial_6B:_Reading_in_csv_Files">Tutorial 6b</a>.</p>
<p><a href="https://github.com/psu-spatial/Geog364.data-2020/raw/main/Point_Iowa_FarmersMarket/Farmers_Markets.xlsx">This link contains the csv used in this tutorial of Iowan farmers markets</a>. I downloaded this, then read it into R, made it spatial, changed the map projection and made a quick plot.</p>
<pre class="r"><code>IA_farmersmarket   &lt;- readxl::read_excel(&quot;Farmers_Markets.xlsx&quot;)
names(IA_farmersmarket)</code></pre>
<pre><code>##  [1] &quot;X&quot;           &quot;Y&quot;           &quot;FID&quot;         &quot;City&quot;        &quot;County&quot;     
##  [6] &quot;Latitude&quot;    &quot;Location&quot;    &quot;Longitude&quot;   &quot;Market_Name&quot; &quot;Open_Dates&quot; 
## [11] &quot;Open_Hours&quot;  &quot;State&quot;       &quot;Weekday&quot;</code></pre>
<pre class="r"><code># Note, X and Y because that&#39;s what the columns are called. 
# I know that it was in lat/long originally, hence the crs
IA_farmersmarket.sf &lt;- st_as_sf(IA_farmersmarket,coords=c(&quot;X&quot;,&quot;Y&quot;),crs=4326)

# And change to a map projection of your choice. I am choosing UTM Iowa
IA_farmersmarket.sf &lt;- st_transform(IA_farmersmarket.sf,3744)

# make a quick plot
tmap_mode(&quot;view&quot;)</code></pre>
<pre><code>## tmap mode set to interactive viewing</code></pre>
<pre class="r"><code>qtm(st_geometry(IA_farmersmarket.sf))</code></pre>
<div id="htmlwidget-c60c4cc7faef0ab73fa3" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-c60c4cc7faef0ab73fa3">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"createMapPane","args":["tmap402",402]},{"method":"addProviderTiles","args":["Esri.WorldGrayCanvas",null,"Esri.WorldGrayCanvas",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,"Esri.WorldTopoMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addCircleMarkers","args":[[43.3657070000022,40.8196330000025,41.0470440000023,41.6110330000024,40.6240150000024,40.5334140000025,42.3965380000022,41.6618650000025,37.2941130000028,40.3934520000025,40.6326308000025,40.6767720000024,40.7234200000024,40.7295300000025,40.7376290000023,40.7382528000023,40.7516820000025,40.7516820000025,40.7575670000024,40.7630940000023,40.7631880000023,40.8103451000025,40.8150220000025,40.8150220000025,40.9568640000025,40.9658000000025,41.0086300000024,41.0099980000025,41.0102977000025,41.0116667000023,41.0172200000024,41.0172200000024,41.0188200000024,41.0195490000024,41.0266667000024,41.0272800000023,41.0341680000024,41.0341680000024,41.0501006100024,41.2533680000023,41.2610020000023,41.2950400000024,41.2950400000024,41.2983977000025,41.3189055000024,41.3195910000024,41.3346060000024,41.3566170000024,41.3566170000024,41.3927150000024,41.4038770000023,41.4038770000023,41.4041290000024,41.4042280000023,41.4045300000024,41.4258800000025,41.4465000000025,41.4766120000023,41.4795690000024,41.4949820000024,41.5021955600025,41.5198930000025,41.5200520000025,41.5200520000025,41.5226440000024,41.5250960000025,41.5251800000025,41.5625690000025,41.5625690000025,41.5791170000024,41.5838010000023,41.5852980000024,41.5920910000024,41.5990980000024,41.5994990000024,41.6086770000023,41.6247150000024,41.6261380000024,41.6466930000023,41.6466930000023,41.6596550000025,41.6600800000025,41.6712590000025,41.6729620000024,41.6784590000024,41.6843740000024,41.6918500000023,41.7003210000024,41.7296370000024,41.7720945000025,41.8384410000023,41.8724210000025,41.8912800000024,41.8970515000024,41.9239730000025,41.9768100000024,41.9956320000024,42.0157320000024,42.0166667000023,42.0178400000023,42.0250696000023,42.0272450000024,42.0272450000024,42.0272450000024,42.0360300000023,42.0364760000024,42.0441500000024,42.0497250000023,42.0497250000023,42.0504310000024,42.0656510000023,42.0656510000023,42.0691460000025,42.1083070000025,42.1083070000025,42.1652530000024,42.2239800000024,42.2372104000025,42.2372104000025,42.2678890000023,42.3453240000023,42.3605833000024,42.3616490000024,42.3974400000023,42.3976900000024,42.4687730000024,42.4694290000024,42.4772720000024,42.4817700000024,42.4839780000024,42.4927641000024,42.4950600000024,42.4908195330022,42.5032200000023,42.5047720000023,42.5060810000025,42.5177000000024,42.5196300000023,42.5291439000023,42.5359120000024,42.6449610000022,42.6450200000023,42.6733170000024,42.6831110000024,42.6904560000024,42.7247707000024,42.7250540000024,42.7318190000023,42.7368360000023,42.7485280000022,42.7801300000024,42.8309100000022,42.9396673000023,43.0678670000023,43.0678670000023,43.0681420000023,43.0681420000023,43.1110520000022,43.1110520000022,43.1271670000022,43.1271670000022,43.1375710000022,43.1393200000023,43.1493730000023,43.1805000000022,43.1805000000022,43.2632520000023,43.2767600000024,43.3636900000023,43.3725050000023,43.3725050000023,43.4020610000022,43.4020610000022,43.4255560000022,43.4255560000022],[-95.1376600000021,-91.1712450000021,-95.7429290000022,-93.6867740000021,-93.9255950000022,-91.4159390000021,-96.3507880000022,-92.0096690000021,-87.118935000002,-91.3828120000021,-91.3140894000021,-94.7161190000022,-92.8677900000021,-91.9614300000021,-95.0360830000022,-95.0365194000022,-92.4149480000021,-92.4149480000021,-93.3174800000021,-95.3750837000022,-95.3750340000022,-91.1000336000021,-91.1440050000021,-91.1440050000021,-91.5471960000021,-91.5535500000021,-92.4333700000021,-91.9585040000021,-91.9632328000021,-95.2272222000022,-92.4363400000021,-92.4363400000021,-92.4300500000021,-93.3065580000021,-92.8052778000021,-95.2141500000022,-93.7666170000022,-93.7666170000022,-94.3853259100021,-95.8516460000022,-95.8489530000022,-92.6441300000021,-92.6441300000021,-91.6917446000021,-93.0974369000021,-93.0973240000021,-94.0133590000021,-93.5793610000022,-93.5793610000022,-93.2775190000021,-94.9963610000022,-94.9963610000022,-92.9183500000021,-95.0135210000022,-92.9193400000021,-91.0485380000021,-91.0299400000021,-95.3393750000022,-93.6776930000022,-93.4858950000021,-94.3184906200022,-90.5810700000021,-90.5789630000021,-90.5789630000021,-93.6029050000021,-90.5022980000021,-90.5031700000021,-90.5754170000021,-90.5754170000021,-93.7088850000021,-95.8466190000022,-93.6204000000021,-93.6003790000021,-93.5032580000021,-93.6606390000021,-93.8780670000021,-93.5818950000021,-93.6771540000021,-95.3389800000022,-95.3389800000022,-91.5292670000021,-91.5290450000021,-91.3467100000021,-93.6976780000021,-91.5837940000021,-93.9600120000021,-94.3649600000021,-93.0546710000021,-93.6085510000022,-91.1284032000021,-94.1065694000021,-90.178635000002,-93.6069300000021,-92.2798722000021,-91.4200210000021,-91.6649550000021,-92.5783230000021,-92.9116620000021,-94.3766667000021,-95.3643300000021,-93.6153515000021,-91.6575320000021,-91.6575320000021,-91.6575320000021,-93.8796920000021,-91.6828160000021,-91.5794500000021,-93.6224750000021,-93.6224750000021,-92.9097120000021,-94.8719710000022,-94.8719710000022,-90.6511330000021,-91.2794800000021,-91.2794800000021,-92.0229420000021,-91.8735500000021,-91.1868006000021,-91.1868006000021,-94.7331920000021,-95.4686900000022,-93.1034738000021,-92.7685320000021,-94.6337500000022,-92.4557200000021,-91.8950960000021,-92.3569410000021,-92.2901380000021,-91.1121600000021,-91.4554060000021,-92.3429631000021,-92.3432850000021,-96.4081792830022,-94.1612400000022,-94.1626170000021,-90.6652980000021,-92.4562500000021,-93.2630540000021,-94.5341421000021,-92.4481510000021,-95.1999450000021,-95.1998520000022,-91.9135060000021,-91.5365260000021,-91.9129190000021,-92.4680460000021,-92.4674340000021,-93.7328490000021,-93.3699220000021,-95.5539090000022,-91.0950200000021,-96.5572970000022,-93.7932485000021,-94.2367020000021,-94.2367020000021,-92.6775970000021,-92.6775970000021,-94.6825680000021,-94.6825680000021,-95.1456910000021,-95.1456910000021,-95.1453830000021,-93.3781700000021,-93.2472900000021,-95.8533250000021,-95.8533250000021,-93.6385980000021,-91.4749100000021,-92.5562000000021,-92.1184310000021,-92.1184310000021,-94.8286510000021,-94.8286510000021,-95.1140900000021,-95.1140900000021],[2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"st_geometry(IA_farmersmarket.sf)",{"interactive":true,"className":"","pane":"tmap401","stroke":true,"color":"#666666","weight":1,"opacity":0.5,"fill":true,"fillColor":["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],"fillOpacity":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},null,null,null,null,[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["Esri.WorldGrayCanvas","OpenStreetMap","Esri.WorldTopoMap"],"st_geometry(IA_farmersmarket.sf)",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":false,"updateWhenIdle":true,"position":"bottomright"}]}],"limits":{"lat":[37.2941130000028,43.4255560000022],"lng":[-96.5572970000022,-87.118935000002]},"fitBounds":[37.2941130000028,-96.5572970000022,43.4255560000022,-87.118935000002,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
<div id="trouble-shooting" class="section level3">
<h3>Trouble shooting</h3>
<p>You can see in the plot above that there appears to be one point that is not in Iowa. So now I will look at the long/lat columns.</p>
<pre class="r"><code>summary(IA_farmersmarket$X)</code></pre>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##  -96.56  -94.37  -93.10  -93.12  -91.78  -87.12</code></pre>
<pre class="r"><code>hist(IA_farmersmarket$X)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-3-1.png" /><!-- --></p>
<p>I feel that maybe that point at Long ~ -88 is wrong. Let’s take a look.</p>
<pre class="r"><code>IA_farmersmarket[IA_farmersmarket$X &gt; -90,]</code></pre>
<pre><code>## # A tibble: 1 × 13
##       X     Y   FID City         County Latitude Location  Longitude Market_Name
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;        &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;      
## 1 -87.1  37.3     9 Central City LINN       37.3 South 5t…     -87.1 Atlantic F…
## # … with 4 more variables: Open_Dates &lt;chr&gt;, Open_Hours &lt;chr&gt;, State &lt;chr&gt;,
## #   Weekday &lt;chr&gt;</code></pre>
<p>I’m guessing there’s a typo - so I could just google this and fix it! but for now, let’s remove and try again.</p>
<pre class="r"><code># choose all the other ones, note the &lt;= instead of &gt;
IA_farmersmarket &lt;- IA_farmersmarket[IA_farmersmarket$X &lt;= -90,]

# Note, X and Y because that&#39;s what the columns are called. 
# I know that it was in lat/long originally, hence the crs
IA_farmersmarket.sf &lt;- st_as_sf(IA_farmersmarket,coords=c(&quot;X&quot;,&quot;Y&quot;),crs=4326)

# And change to a map projection of your choice. I am choosing UTM Iowa
IA_farmersmarket.sf &lt;- st_transform(IA_farmersmarket.sf,3744)

# make a quick plot
tmap_mode(&quot;view&quot;)</code></pre>
<pre><code>## tmap mode set to interactive viewing</code></pre>
<pre class="r"><code>qtm(st_geometry(IA_farmersmarket.sf))</code></pre>
<div id="htmlwidget-6d7566a38b443f0d6cdd" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-6d7566a38b443f0d6cdd">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"createMapPane","args":["tmap402",402]},{"method":"addProviderTiles","args":["Esri.WorldGrayCanvas",null,"Esri.WorldGrayCanvas",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,"Esri.WorldTopoMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addCircleMarkers","args":[[43.3657070000022,40.8196330000025,41.0470440000023,41.6110330000024,40.6240150000024,40.5334140000025,42.3965380000022,41.6618650000025,40.3934520000025,40.6326308000025,40.6767720000024,40.7234200000024,40.7295300000025,40.7376290000023,40.7382528000023,40.7516820000025,40.7516820000025,40.7575670000024,40.7630940000023,40.7631880000023,40.8103451000025,40.8150220000025,40.8150220000025,40.9568640000025,40.9658000000025,41.0086300000024,41.0099980000025,41.0102977000025,41.0116667000023,41.0172200000024,41.0172200000024,41.0188200000024,41.0195490000024,41.0266667000024,41.0272800000023,41.0341680000024,41.0341680000024,41.0501006100024,41.2533680000023,41.2610020000023,41.2950400000024,41.2950400000024,41.2983977000025,41.3189055000024,41.3195910000024,41.3346060000024,41.3566170000024,41.3566170000024,41.3927150000024,41.4038770000023,41.4038770000023,41.4041290000024,41.4042280000023,41.4045300000024,41.4258800000025,41.4465000000025,41.4766120000023,41.4795690000024,41.4949820000024,41.5021955600025,41.5198930000025,41.5200520000025,41.5200520000025,41.5226440000024,41.5250960000025,41.5251800000025,41.5625690000025,41.5625690000025,41.5791170000024,41.5838010000023,41.5852980000024,41.5920910000024,41.5990980000024,41.5994990000024,41.6086770000023,41.6247150000024,41.6261380000024,41.6466930000023,41.6466930000023,41.6596550000025,41.6600800000025,41.6712590000025,41.6729620000024,41.6784590000024,41.6843740000024,41.6918500000023,41.7003210000024,41.7296370000024,41.7720945000025,41.8384410000023,41.8724210000025,41.8912800000024,41.8970515000024,41.9239730000025,41.9768100000024,41.9956320000024,42.0157320000024,42.0166667000023,42.0178400000023,42.0250696000023,42.0272450000024,42.0272450000024,42.0272450000024,42.0360300000023,42.0364760000024,42.0441500000024,42.0497250000023,42.0497250000023,42.0504310000024,42.0656510000023,42.0656510000023,42.0691460000025,42.1083070000025,42.1083070000025,42.1652530000024,42.2239800000024,42.2372104000025,42.2372104000025,42.2678890000023,42.3453240000023,42.3605833000024,42.3616490000024,42.3974400000023,42.3976900000024,42.4687730000024,42.4694290000024,42.4772720000024,42.4817700000024,42.4839780000024,42.4927641000024,42.4950600000024,42.4908195330022,42.5032200000023,42.5047720000023,42.5060810000025,42.5177000000024,42.5196300000023,42.5291439000023,42.5359120000024,42.6449610000022,42.6450200000023,42.6733170000024,42.6831110000024,42.6904560000024,42.7247707000024,42.7250540000024,42.7318190000023,42.7368360000023,42.7485280000022,42.7801300000024,42.8309100000022,42.9396673000023,43.0678670000023,43.0678670000023,43.0681420000023,43.0681420000023,43.1110520000022,43.1110520000022,43.1271670000022,43.1271670000022,43.1375710000022,43.1393200000023,43.1493730000023,43.1805000000022,43.1805000000022,43.2632520000023,43.2767600000024,43.3636900000023,43.3725050000023,43.3725050000023,43.4020610000022,43.4020610000022,43.4255560000022,43.4255560000022],[-95.1376600000021,-91.1712450000021,-95.7429290000022,-93.6867740000021,-93.9255950000022,-91.4159390000021,-96.3507880000022,-92.0096690000021,-91.3828120000021,-91.3140894000021,-94.7161190000022,-92.8677900000021,-91.9614300000021,-95.0360830000022,-95.0365194000022,-92.4149480000021,-92.4149480000021,-93.3174800000021,-95.3750837000022,-95.3750340000022,-91.1000336000021,-91.1440050000021,-91.1440050000021,-91.5471960000021,-91.5535500000021,-92.4333700000021,-91.9585040000021,-91.9632328000021,-95.2272222000022,-92.4363400000021,-92.4363400000021,-92.4300500000021,-93.3065580000021,-92.8052778000021,-95.2141500000022,-93.7666170000022,-93.7666170000022,-94.3853259100021,-95.8516460000022,-95.8489530000022,-92.6441300000021,-92.6441300000021,-91.6917446000021,-93.0974369000021,-93.0973240000021,-94.0133590000021,-93.5793610000022,-93.5793610000022,-93.2775190000021,-94.9963610000022,-94.9963610000022,-92.9183500000021,-95.0135210000022,-92.9193400000021,-91.0485380000021,-91.0299400000021,-95.3393750000022,-93.6776930000022,-93.4858950000021,-94.3184906200022,-90.5810700000021,-90.5789630000021,-90.5789630000021,-93.6029050000021,-90.5022980000021,-90.5031700000021,-90.5754170000021,-90.5754170000021,-93.7088850000021,-95.8466190000022,-93.6204000000021,-93.6003790000021,-93.5032580000021,-93.6606390000021,-93.8780670000021,-93.5818950000021,-93.6771540000021,-95.3389800000022,-95.3389800000022,-91.5292670000021,-91.5290450000021,-91.3467100000021,-93.6976780000021,-91.5837940000021,-93.9600120000021,-94.3649600000021,-93.0546710000021,-93.6085510000022,-91.1284032000021,-94.1065694000021,-90.178635000002,-93.6069300000021,-92.2798722000021,-91.4200210000021,-91.6649550000021,-92.5783230000021,-92.9116620000021,-94.3766667000021,-95.3643300000021,-93.6153515000021,-91.6575320000021,-91.6575320000021,-91.6575320000021,-93.8796920000021,-91.6828160000021,-91.5794500000021,-93.6224750000021,-93.6224750000021,-92.9097120000021,-94.8719710000022,-94.8719710000022,-90.6511330000021,-91.2794800000021,-91.2794800000021,-92.0229420000021,-91.8735500000021,-91.1868006000021,-91.1868006000021,-94.7331920000021,-95.4686900000022,-93.1034738000021,-92.7685320000021,-94.6337500000022,-92.4557200000021,-91.8950960000021,-92.3569410000021,-92.2901380000021,-91.1121600000021,-91.4554060000021,-92.3429631000021,-92.3432850000021,-96.4081792830022,-94.1612400000022,-94.1626170000021,-90.6652980000021,-92.4562500000021,-93.2630540000021,-94.5341421000021,-92.4481510000021,-95.1999450000021,-95.1998520000022,-91.9135060000021,-91.5365260000021,-91.9129190000021,-92.4680460000021,-92.4674340000021,-93.7328490000021,-93.3699220000021,-95.5539090000022,-91.0950200000021,-96.5572970000022,-93.7932485000021,-94.2367020000021,-94.2367020000021,-92.6775970000021,-92.6775970000021,-94.6825680000021,-94.6825680000021,-95.1456910000021,-95.1456910000021,-95.1453830000021,-93.3781700000021,-93.2472900000021,-95.8533250000021,-95.8533250000021,-93.6385980000021,-91.4749100000021,-92.5562000000021,-92.1184310000021,-92.1184310000021,-94.8286510000021,-94.8286510000021,-95.1140900000021,-95.1140900000021],[2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619,2.82842712474619],[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],"st_geometry(IA_farmersmarket.sf)",{"interactive":true,"className":"","pane":"tmap401","stroke":true,"color":"#666666","weight":1,"opacity":0.5,"fill":true,"fillColor":["#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000","#000000"],"fillOpacity":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},null,null,null,null,[null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[["Esri.WorldGrayCanvas","OpenStreetMap","Esri.WorldTopoMap"],"st_geometry(IA_farmersmarket.sf)",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":false,"updateWhenIdle":true,"position":"bottomright"}]}],"limits":{"lat":[40.3934520000025,43.4255560000022],"lng":[-96.5572970000022,-90.178635000002]},"fitBounds":[40.3934520000025,-96.5572970000022,43.4255560000022,-90.178635000002,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<div id="shapefiles" class="section level2">
<h2>Shapefiles</h2>
<div id="downloading-a-shapefile-point-or-polygon" class="section level3">
<h3>Downloading a Shapefile (point or polygon)</h3>
<p>There’s also another example in <a href="https://psu-spatial.github.io/Geog364-2021/pg_Tut6_input_output.html#Tutorial_6C:_Reading_in_%E2%80%9CShape_Files%E2%80%9D">Tutorial 6C</a></p>
<p>I’m going to use an SVI shape-file that we used in Lab 6. I have stored this on github, so I can download it directly. Note, a shape-file is a group of files TOGETHER that are often stored in a single folder.</p>
<p><a href="https://github.com/psu-spatial/Geog364.data-2020/raw/main/Polygon_SVI_Iowa_shp/Iowa_COUNTY_SVI.zip">This link contains the Shapefile used in this tutorial of Iowan SVI data</a>. I downloaded it and put it in my project folder. I downloaded a zip file</p>
<p><img src="Figures/DatTut_Fig1.png" width="1452" /></p>
<p><br></p>
<p>You can unzip the file this using this command, or double click on the zip file on your computer.</p>
<pre class="r"><code>unzip(&quot;Iowa_COUNTY_SVI.zip&quot;)</code></pre>
<p>This should unzip all the files into your project folder. Note that the file-names might be different to the zipfile name!</p>
<p><img src="Figures/DatTut_Fig2.png" width="1466" /></p>
<p><br></p>
<p class="comment">
<p>Sometimes this will unzip these into a sub-folder. You can deal with this, but it is easier to just move ALL the sub-files into the main project folder.</p>
</p>
<p><br><br></p>
</div>
<div id="opening-a-shapefile" class="section level3">
<h3>Opening a Shapefile</h3>
<p>Make sure that <code>library(sp)</code> and <code>library(sf)</code> are in your library code chunk at the top.</p>
<p>The command to read in any shapefile is <code>st_read()</code> from the sf library. Set it to read in the .shp extension. You should see something like this, but remember that you can suppress output using message=FALSE,warning=FALSE and results=FALSE at the top of the code chunk.</p>
<pre class="r"><code># Note the .shp extension 
# and that the filename is different to the zip file name!
SVI_county.sf &lt;- st_read(&quot;SVI2018_IOWA_county.shp&quot;)</code></pre>
<pre><code>## Reading layer `SVI2018_IOWA_county&#39; from data source 
##   `/Users/hlg5155/Dropbox/My Mac (E2-GEO-WKML011)/Documents/GitHub/Teaching/Geog364-2021/SVI2018_IOWA_county.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 99 features and 125 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -96.6397 ymin: 40.3755 xmax: -90.14006 ymax: 43.5012
## Geodetic CRS:  NAD83</code></pre>
<pre class="r"><code># and change to a map projection of your choice. I am choosing UTM Iowa
SVI_county.sf &lt;- st_transform(SVI_county.sf,3744)</code></pre>
<p><br></p>
<p>To check it worked, click on the name of the variable in the environment tab and plot the geometry</p>
<pre class="r"><code>#Remember st_geometry removes the marks.
plot(st_geometry(SVI_county.sf))</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-8-1.png" /><!-- --></p>
<p><br><br></p>
</div>
<div id="troubleshooting" class="section level3">
<h3>Troubleshooting</h3>
<p>Sometimes you will get this error.</p>
<p><img src="Figures/DatTut_Fig3.png" width="1442" /></p>
<p><br></p>
<p>This means that it can’t find the file. There are three common reasons for this.</p>
<ol style="list-style-type: decimal">
<li>You didn’t create a project, or open you didn’t open R-studio by double clicking your project file. If you have no idea what I mean, see <a href="https://psu-spatial.github.io/Geog364-2021/pg_Tut2_startup.html#Tutorial_2C:_Create_an_R-Project">Tutorial 2C</a>.</li>
<li>You unzipped your shape-file into a different place. You should be able to see them next to your code in your files tab with zero sub-folders.</li>
<li>You mis-typed the file-name. It is case sensitive and requires the .shp at the end.</li>
</ol>
<p>Let’s see what I did wrong. Here is my screen. You can see that I am running my R-project correctly (red circles) and I have unzipped all my files correctly. But! I got the wrong file name.</p>
<p><img src="Figures/DatTut_Fig4.png" width="2794" /></p>
</div>
</div>
<div id="raster-data-geotifs-netcdf" class="section level2">
<h2>Raster data (geotifs, netcdf)</h2>
<p>Put the raster in your project folder. This is likely a geotif (.tif) or a NetCDF file (.nc).</p>
<p>Read in the data using the raster command</p>
<pre class="r"><code>WhatYouWantToCallYourVariable &lt;- raster(&#39;FILENAME.tif&#39;)</code></pre>
<p>If your data is numeric, to extract for your points/polygons follow the tutorial in elevation</p>
<p>If your data is categorical, to extract for your points/polygons, follow the tutorial for landcover.</p>
<p><br><br></p>
</div>
<div id="borders" class="section level2">
<h2>Borders</h2>
<div id="country-state-borders" class="section level3">
<h3>Country, State borders</h3>
<p>There are many ways of doing this, see <a href="https://psu-spatial.github.io/Geog364-2021/pg_Tut11_spatial101.html#c_Using_RNaturalEarth_built-in_vector_datasets">Tutorial 11</a> for more detail.</p>
<p>I am going to use the <code>rnaturalearth</code> package. Make sure <code>library(rnaturalearth)</code> is in your library code chunk at the top.</p>
<pre class="r"><code># world borders, read in 
border.country.world.sf &lt;- ne_countries(returnclass = &quot;sf&quot;)

# US States
border.state.USA.sf  &lt;-  ne_states(country=&quot;united states of america&quot;,returnclass = &quot;sf&quot;)

# Make a plot to check
plot(st_geometry(border.country.world.sf),border=&quot;red&quot;)
plot(st_geometry(border.state.USA.sf),col=&quot;light blue&quot;,add=TRUE)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-10-1.png" /><!-- --></p>
<pre class="r"><code># change projection so the maps overlay just over the Iowa area
border.state.USA.sf  &lt;-  st_transform(border.state.USA.sf,3744)

plot(st_geometry(IA_farmersmarket.sf),col=rgb(0,0,0,.5),pch=16)
plot(st_geometry(border.state.USA.sf),border=&quot;red&quot;,add=TRUE)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-11-1.png" /><!-- --> ### rworldmap</p>
<p>There is also rworldmap that I haven’t explored yet.</p>
<pre class="r"><code>#library(rworldmap)  
#lines(getMap(resolution = &quot;high&quot;), lwd=2)   </code></pre>
</div>
<div id="counties-and-census-tracts-borders" class="section level3">
<h3>Counties and census tracts borders</h3>
<p>This is often easist to do by using <code>get_acs</code> (see below), but if you really want borders, then the <code>USAboundaries()</code> package is your best bet.</p>
<pre class="r"><code>border.county.IA.sf &lt;- us_counties(states=&quot;Iowa&quot;)
border.county.IA.sf  &lt;-  st_transform(border.county.IA.sf,3744)

plot(st_geometry(IA_farmersmarket.sf),col=rgb(0,0,0,.5),pch=16)
plot(st_geometry(border.state.USA.sf),add=TRUE,border=&quot;red&quot;)
plot(st_geometry(border.county.IA.sf),add=TRUE,border=&quot;blue&quot;)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-13-1.png" /><!-- --></p>
</div>
<div id="coastlines-and-reef-data" class="section level3">
<h3>Coastlines and reef data</h3>
<p>For those doing coastline projects, you can also download coastline and reef data using rnaturalearth</p>
<pre class="r"><code>coast.world.sf &lt;- ne_coastline(returnclass = &quot;sf&quot;)
reefs.world.sf &lt;- ne_download( scale = &#39;large&#39;, category=&quot;physical&quot;, type = &#39;reefs&#39; ,returnclass = &quot;sf&quot;)

plot(st_geometry(reefs.world.sf),col=&quot;blue&quot;)
plot(st_geometry(coast.world.sf),add=TRUE)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-14-1.png" /><!-- --></p>
</div>
</div>
<div id="us-census-data" class="section level2">
<h2>US Census data</h2>
<div id="the-get_acs-command" class="section level3">
<h3>The get_acs command</h3>
<p>Make sure <code>library(tidycensus)</code> , <code>library(units)</code> ,<code>library(sp)</code> , <code>library(sf)</code> and <code>library(tmap)</code> are loaded in your library code chunk.</p>
<p>This is useful for population density!</p>
<p>There are full tutorials in <a href="https://psu-spatial.github.io/Geog364-2021/pg_Tut2_startup.html#Tutorial_2C:_Create_an_R-Project">Tutorial 6Ce</a> and in <a href="https://psu-spatial.github.io/Geog364-2021/pg_364Lab7_Regression_2021.html#Download_the_data_from_ACS">Lab 7</a>.</p>
<p>Here is all of the code together:</p>
<pre class="r"><code># Download some data for Iowa using get_acs
ACS_county.sf &lt;- get_acs(geography = &quot;county&quot;, 
                         year = 2019,
                         variables = c(housevalue       = &quot;B25075_001&quot;,  # house value
                                       total_pop        = &quot;B05012_001&quot;,  # total population
                                       total_house      = &quot;B25001_001&quot;,  # total housing units  
                                       med.income       = &quot;B19013_001&quot;), # median income  
                         state = c(&quot;IA&quot;),
                         survey = &quot;acs5&quot;,geometry=TRUE,
                         output = &quot;wide&quot;)

# Change the map projection to UTM Iowa
ACS_county.sf &lt;- st_transform(ACS_county.sf,3744)

# Get the areas
ACS_county.sf$County.areaE &lt;- st_area(ACS_county.sf)

# Change the units of the areas from metres squared to km squared and overwrite
ACS_county.sf$County.areaE &lt;- set_units(ACS_county.sf$County.areaE,&quot;km^2&quot;)

# and divide the total population by the area
ACS_county.sf$PopulationDensityE &lt;-ACS_county.sf$total_popE /  ACS_county.sf$County.areaE

# check it worked. Iowa is a boring state!
map_totalpop &lt;- qtm(ACS_county.sf,&quot;total_popE&quot;)+tm_layout(legend.outside = TRUE)
map_area     &lt;- qtm(ACS_county.sf,&quot;County.areaE&quot;)+tm_layout(legend.outside = TRUE)
map_popdens  &lt;- qtm(ACS_county.sf,&quot;PopulationDensityE&quot;)+tm_layout(legend.outside = TRUE)
tmap_mode(&quot;plot&quot;)
suppressWarnings(tmap_arrange(map_totalpop,map_area,map_popdens))</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-15-1.png" /><!-- --></p>
<pre class="r"><code># clean up your workspace, optional but good practice unless you later need this map
rm(map_totalpop); rm(map_area); rm(map_popdens)</code></pre>
</div>
<div id="dealing-with-non-normal-data-e.g.-population-density" class="section level3">
<h3>Dealing with non-Normal data (e.g. population density)</h3>
<p>Population density, wealth and housing density are often very skewed, making the statistics hard. To get around this and to see more detail outside cities, we can take the log and save as a new column. For example</p>
<pre class="r"><code>ACS_county.sf$Log_PopulationDensityE &lt;- log(ACS_county.sf$PopulationDensityE)</code></pre>
<p>Comparing histograms</p>
<pre class="r"><code>par(mfrow=c(1,2))
hist(ACS_county.sf$PopulationDensityE,
     main=list(&quot;Population Density&quot;,cex=.7),xlab=list(&quot;Population Density&quot;,cex=.7))

hist(ACS_county.sf$Log_PopulationDensityE,
     main=list(&quot;Log Population Density per Km^2&quot;,cex=.7),xlab=list(&quot;log Population Density per Km^2&quot;,cex=.7))</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-17-1.png" /><!-- --></p>
<p>Comparing maps</p>
<pre class="r"><code>map_popdens    &lt;- qtm(ACS_county.sf,&quot;PopulationDensityE&quot;,fill.palette=&quot;RdPu&quot;)+
                      tm_layout(legend.outside = TRUE)

map_logpopdens &lt;- qtm(ACS_county.sf,&quot;Log_PopulationDensityE&quot;,fill.palette=&quot;RdPu&quot;)+
                      tm_layout(legend.outside = TRUE)

tmap_arrange(map_popdens,map_logpopdens)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-18-1.png" /><!-- --></p>
</div>
<div id="extracting-census-data-at-point-locations" class="section level3">
<h3>Extracting Census data at point locations</h3>
<p>See the project tutorial:</p>
<ul>
<li><a href="https://psu-spatial.github.io/Geog364-2021/364Data_TutorialWranglePoint.html#Extracting_point_values_from_polygons" class="uri">https://psu-spatial.github.io/Geog364-2021/364Data_TutorialWranglePoint.html#Extracting_point_values_from_polygons</a></li>
</ul>
</div>
</div>
<div id="elevation-data" class="section level2">
<h2>Elevation data</h2>
<div id="downloading-the-data" class="section level3">
<h3>Downloading the data</h3>
<p>Make sure that <code>library(elevatr)</code> and <code>library(raster)</code> are in your library code chunk at the top.</p>
<p>The <code>elevatr</code> package will allow you to download elevation data for a spatial area of your choice. It might break on the cloud. If so, let Dr G know - she can download you a subset.</p>
<p>Here we can extract elevation data just for the area we care about. E.g. here, I will extract for my farmers market data and my county SVI data.</p>
<p>REMEMBER TO PUT results=FALSE IN YOUR CODE CHUNK OPTIONS HERE.</p>
<pre class="r"><code># YOU WILL ONLY NEED ONE OF THESE

# Here I downloaded elevation for the border of my SVI data 
elevation.raster_SVI &lt;- elevatr::get_elev_raster(SVI_county.sf, z = 5,clip=&quot;locations&quot;)


# here I downloaded elevation for the area around my farmers markets (R doesn&#39;t understand this is Iowa!)
elevation.raster_farm &lt;- elevatr::get_elev_raster(IA_farmersmarket.sf, z = 5,clip=&quot;locations&quot;)


# here I downloaded it for the border of Iowa itself using my counties
elevation.raster_IA &lt;- elevatr::get_elev_raster(border.county.IA.sf, z = 5,clip=&quot;locations&quot;)


# here I created a long/lat box
Lonbox &lt;- c(-93,-93  ,-95,-95)
Latbox &lt;- c( 41, 41.5, 41, 41.5)
box_LongLat &lt;- data.frame(Lon=Lonbox,Lat=Latbox)
box_LongLat.sf  &lt;- st_as_sf(box_LongLat,coords=c(&quot;Lon&quot;,&quot;Lat&quot;),crs=4326)
box_LongLat.sf  &lt;- st_transform(box_LongLat.sf,3744)

elevation.raster_box &lt;- elevatr::get_elev_raster(box_LongLat.sf, z = 5,clip=&quot;bbox&quot;)</code></pre>
<p>Note when I plot, the results look like they are on a globe because of the UTM map projection.</p>
<pre class="r"><code># set up a 2x3 grid of plots
par(mfrow=c(2,2))

# plot 1
plot(elevation.raster_SVI)
plot(st_geometry(SVI_county.sf),add=TRUE)

# plot 2
plot(elevation.raster_farm)
plot(st_geometry(IA_farmersmarket.sf),add=TRUE)
plot(st_geometry(border.state.USA.sf),add=TRUE)

# plot 3
plot(elevation.raster_IA)
plot(st_geometry(border.county.IA.sf),add=TRUE)

# plot 4
plot(elevation.raster_box)
plot(st_geometry(border.county.IA.sf),add=TRUE)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-20-1.png" /><!-- --></p>
</div>
<div id="adding-elevation-data-to-your-datasets" class="section level3">
<h3>Adding elevation data to your datasets</h3>
<p>Make sure that <code>library(exactextractr)</code> and <code>library(raster)</code> are in your library code chunk at the top.</p>
<p>We can simply use this package to extract the value at our locations - I’m choosing the average over the polygon. To extract</p>
<pre class="r"><code># add to polygon data
SVI_county.sf$Elevation_extracted &lt;- exact_extract(elevation.raster_SVI,SVI_county.sf,&quot;mean&quot;)</code></pre>
<p>For point data, we choose simply the extract function.</p>
<pre class="r"><code># add to point data
IA_farmersmarket.sf$Elevation_extracted &lt;- raster::extract(elevation.raster_farm,IA_farmersmarket.sf)</code></pre>
<p>Click on the name of your dataset, you will see there is a new column called elevation. Here is what we have done</p>
<pre class="r"><code># plot 1
map1 &lt;- qtm(elevation.raster_SVI)+tm_layout(legend.outside = TRUE)
map2 &lt;- qtm(SVI_county.sf,&quot;Elevation_extracted&quot;)+tm_layout(legend.outside = TRUE)
map3 &lt;- qtm(elevation.raster_farm)+tm_layout(legend.outside = TRUE)

map4 &lt;- qtm(IA_farmersmarket.sf,dots.col=&quot;Elevation_extracted&quot;)+
        tm_shape(border.county.IA.sf)+tm_polygons(alpha=0)+
        tm_layout(legend.outside = TRUE)

tmap_arrange(map1,map2,map3,map4)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-23-1.png" /><!-- --></p>
<pre class="r"><code>rm(map1);rm(map2);rm(map3);rm(map4)</code></pre>
</div>
</div>
<div id="land-cover-forest-canopy-or-concrete" class="section level2">
<h2>Land Cover, forest canopy or concrete</h2>
<p>(contributed by Susan)</p>
<p>We can download land cover data from the National Land Cover Database (NLCD) (<a href="https://www.mrlc.gov/" class="uri">https://www.mrlc.gov/</a>) using the FedData package. This package allows you to download other federal data as well including elevation, soil data from the SSURGO soil database, Daymet weather data, USDA cropland layers, hydrography, etc. See this link (<a href="https://github.com/ropensci/FedData" class="uri">https://github.com/ropensci/FedData</a>) for more information about what data you can obtain using the FedData package. This link has example code for downloading all these data.</p>
<p>First we need to install the ‘<strong>FedData</strong>’ package. We do this the same way as for the high res data packages. Run this code IN YOUR CONSOLE.</p>
<pre class="r"><code>remotes::install_github(&quot;ropensci/FedData&quot;)</code></pre>
<p>Now make sure that these packages are in the code chunk at the top of your script.</p>
<pre class="r"><code>library(FedData)
library(sf)
library(sp)
library(USAboundaries)
library(raster)</code></pre>
<p>Just like elevation or any other raster, we can download just for the area of our study. See below for our Iowa example. You would simply replace with your own sf data and nickname.</p>
<p>If you want forest canopy or concrete areas see the get_nlcd helpfile.</p>
<p>First, let’s look at what the data means</p>
<pre class="r"><code>landcover_legend &lt;- nlcd_colors()
landcover_legend</code></pre>
<pre><code>## # A tibble: 20 × 4
##       ID Class                        Color   Description                       
##    &lt;dbl&gt; &lt;chr&gt;                        &lt;chr&gt;   &lt;chr&gt;                             
##  1    11 Open Water                   #5475A8 Areas of open water, generally wi…
##  2    12 Perennial Ice/Snow           #FFFFFF Areas characterized by a perennia…
##  3    21 Developed, Open Space        #E8D1D1 Areas with a mixture of some cons…
##  4    22 Developed, Low Intensity     #E29E8C Areas with a mixture of construct…
##  5    23 Developed, Medium Intensity  #ff0000 Areas with a mixture of construct…
##  6    24 Developed High Intensity     #B50000 Highly developed areas where peop…
##  7    31 Barren Land (Rock/Sand/Clay) #D2CDC0 Areas of bedrock, desert pavement…
##  8    41 Deciduous Forest             #85C77E Areas dominated by trees generall…
##  9    42 Evergreen Forest             #38814E Areas dominated by trees generall…
## 10    43 Mixed Forest                 #D4E7B0 Areas dominated by trees generall…
## 11    51 Dwarf Scrub                  #AF963C Alaska only areas dominated by sh…
## 12    52 Shrub/Scrub                  #DCCA8F Areas dominated by shrubs; less t…
## 13    71 Grassland/Herbaceous         #FDE9AA Areas dominated by gramanoid or h…
## 14    72 Sedge/Herbaceous             #D1D182 Alaska only areas dominated by se…
## 15    73 Lichens                      #A3CC51 Alaska only areas dominated by fr…
## 16    74 Moss                         #82BA9E Alaska only areas dominated by mo…
## 17    81 Pasture/Hay                  #FBF65D Areas of grasses, legumes, or gra…
## 18    82 Cultivated Crops             #CA9146 Areas used for the production of …
## 19    90 Woody Wetlands               #C8E6F8 Areas where forest or shrubland v…
## 20    95 Emergent Herbaceous Wetlands #64B3D5 Areas where perennial herbaceous …</code></pre>
<pre class="r"><code># THIS TAKE A LONG TIME TO RUN!  
# IT WILL CRASH THE CLOUD.  DR G or SUSAN CAN DOWNLOAD IT FOR YOU

# Here I downloaded land cover for the border of my SVI data. You can choose the nickname
NLCD_SVI &lt;- get_nlcd(template = SVI_county.sf,year = 2011,label = &quot;Iowa SVI landcover&quot;)


# here I downloaded land cover  for the area around my farmers markets (R doesn&#39;t understand this is Iowa!)
NLCD_farm &lt;- get_nlcd(template = IA_farmersmarket.sf,year = 2011,label = &quot;Iowa farmers landcover&quot;)


# here I downloaded land cover  for the border of Iowa itself using my counties
NLCD_IA &lt;- get_nlcd(template = border.county.IA.sf,year = 2011,label = &quot;Iowa  landcover&quot;)</code></pre>
<p>Because it takes long to download large areas, it is better to save the landcover file to your project folder and load it from there instead of downloading it every time you knit your project.</p>
<pre class="r"><code>#Save the landcover dataset to your project folder.
writeRaster(NLCD_IA, 
              filename = &quot;IA_Landcover.tif&quot;, 
              format=&quot;GTiff&quot;, overwrite=TRUE)</code></pre>
<p>After you have successfully downloaded and saved the data to you project folder, you can load it into R using the following code.</p>
<p>If you can load the data successfully, you now do not need any of the above code which is basically for downloading and saving the file. I suggest commenting it out and hiding it in an “include=FALSE, eval-FALSE” code chunk so that you do not lose the code in the event you have to rerun.</p>
<pre class="r"><code>IA_Landcover &lt;- raster(&#39;IA_Landcover.tif&#39;)

tmap_mode(&quot;plot&quot;)</code></pre>
<pre><code>## tmap mode set to plotting</code></pre>
<pre class="r"><code>qtm(IA_Landcover)+tm_layout(legend.outside = TRUE)</code></pre>
<pre><code>## stars_proxy object shown at 1235 by 811 cells.</code></pre>
<pre><code>## Warning: Duplicated levels found. They have been omitted</code></pre>
<pre><code>## Some legend labels were too wide. These labels have been resized to 0.65. Increase legend.width (argument of tm_layout) to make the legend wider and therefore the labels larger.</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-29-1.png" /><!-- --></p>
<div id="adding-land-cover-data-to-your-points-dataset" class="section level3">
<h3>Adding land cover data to your points dataset</h3>
<p>Make sure that <code>library(raster)</code> is in your library code chunk at the top.</p>
<p>For point data, we choose simply the extract function. Here I also added in the key - because the number isn’t very informative.</p>
<pre class="r"><code>#--------------------------------------------------------------
# Turn everything to the same map projection
#--------------------------------------------------------------
IA_farmersmarket.sf  &lt;-  st_transform(IA_farmersmarket.sf,crs(IA_Landcover))

#--------------------------------------------------------------
# add to point data
#--------------------------------------------------------------
IA_farmersmarket.sf$LandcoverNumber &lt;- raster::extract(IA_Landcover,
                                                       IA_farmersmarket.sf)
IA_farmersmarket.sf$LandcoverNumber &lt;- as.factor(IA_farmersmarket.sf$LandcoverNumber)

#--------------------------------------------------------------
# for the landcover data specifically, this might be better
#--------------------------------------------------------------
key &lt;- nlcd_colors()[,c(&quot;ID&quot;,&quot;Class&quot;)]
names(key) &lt;- c(&quot;LandcoverNumber&quot;,&quot;LandcoverClass&quot;)

IA_farmersmarket.sf &lt;- merge(IA_farmersmarket.sf ,key,by=&quot;LandcoverNumber&quot;,all.x=TRUE,all.y=FALSE)
IA_farmersmarket.sf$LandcoverClass &lt;- as.factor(IA_farmersmarket.sf$LandcoverClass )</code></pre>
<pre class="r"><code>map1 &lt;- qtm(IA_Landcover)+tm_layout(legend.outside = TRUE)

map2 &lt;- qtm(IA_farmersmarket.sf,dots.col=&quot;LandcoverClass&quot;,dots.size=.1)+
        tm_shape(border.county.IA.sf)+tm_polygons(alpha=0)+
        tm_layout(legend.outside = TRUE)

tmap_arrange(map1,map2)</code></pre>
<pre><code>## stars_proxy object shown at 1235 by 811 cells.</code></pre>
<pre><code>## Warning: Duplicated levels found. They have been omitted</code></pre>
<pre><code>## stars_proxy object shown at 1235 by 811 cells.</code></pre>
<pre><code>## Warning: Duplicated levels found. They have been omitted</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-31-1.png" /><!-- --></p>
<pre class="r"><code>rm(map1);rm(map2)</code></pre>
</div>
<div id="adding-land-cover-data-to-your-polygons-dataset" class="section level3">
<h3>Adding land cover data to your polygons dataset</h3>
<p>For polygons it’s even more complex because the “mean” landcover doesn’t make sense! I guess in that we want to choose the land-cover with the greatest area in your county.</p>
<pre class="r"><code># This is taking the most common value in each polygon
# add to polygon data
extractedvalues &lt;- data.frame(ID=exact_extract(NLCD_SVI,SVI_county.sf,fun=&quot;majority&quot;))

# add in codes
Newvalues &lt;- merge(extractedvalues,nlcd_colors(),by=&quot;ID&quot;,all.x=TRUE,all.y=FALSE)

# and extract the codes
SVI_county.sf$Majority_LandcoverClass &lt;- as.factor(Newvalues$Class)</code></pre>
<pre class="r"><code>map1 &lt;- qtm(IA_Landcover)+tm_layout(legend.outside = TRUE)

map2 &lt;- qtm(SVI_county.sf,&quot;Majority_LandcoverClass&quot;)+
        tm_shape(border.county.IA.sf)+tm_polygons(alpha=0)+
        tm_layout(legend.outside = TRUE)

tmap_arrange(map1,map2,nrow=2)</code></pre>
<pre><code>## stars_proxy object shown at 1235 by 811 cells.</code></pre>
<pre><code>## Warning: Duplicated levels found. They have been omitted</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-33-1.png" /><!-- --></p>
<pre class="r"><code>rm(map1);rm(map2)</code></pre>
</div>
</div>
<div id="weather-data" class="section level2">
<h2>Weather data</h2>
<div id="worldclim-temperature-rainfall" class="section level3">
<h3>WorldClim Temperature, Rainfall</h3>
<p>We can get weather data from worldclim. There is an excellent tutorial here: <a href="https://bedatablog.netlify.app/post/download-and-illustrate-current-and-projected-climate-in-r/" class="uri">https://bedatablog.netlify.app/post/download-and-illustrate-current-and-projected-climate-in-r/</a></p>
<p>Make sure that<code>library(raster)</code> is in your library code chunk at the top.</p>
<p>See here for details: <a href="https://www.worldclim.org/data/worldclim21.html" class="uri">https://www.worldclim.org/data/worldclim21.html</a> or look at <code>?raster::getData</code>. Valid variables names are</p>
<ul>
<li>‘tmin’: Monthly minimum temperature</li>
<li>‘tmax’: Monthly maximum temperature</li>
<li>‘prec’: Monthly rainfall</li>
<li>and ‘bio’ (<a href="https://www.worldclim.org/data/bioclim.html" class="uri">https://www.worldclim.org/data/bioclim.html</a>), which downloads a list of:
<ul>
<li>BIO1 = Annual Mean Temperature</li>
<li>BIO2 = Mean Diurnal Range (Mean of monthly (max temp - min temp))</li>
<li>BIO3 = Isothermality (BIO2/BIO7) (×100)</li>
<li>BIO4 = Temperature Seasonality (standard deviation ×100)</li>
<li>BIO5 = Max Temperature of Warmest Month</li>
<li>BIO6 = Min Temperature of Coldest Month</li>
<li>BIO7 = Temperature Annual Range (BIO5-BIO6)</li>
<li>BIO8 = Mean Temperature of Wettest Quarter</li>
<li>BIO9 = Mean Temperature of Driest Quarter</li>
<li>BIO10 = Mean Temperature of Warmest Quarter</li>
<li>BIO11 = Mean Temperature of Coldest Quarter</li>
<li>BIO12 = Annual Precipitation</li>
<li>BIO13 = Precipitation of Wettest Month</li>
<li>BIO14 = Precipitation of Driest Month</li>
<li>BIO15 = Precipitation Seasonality (Coefficient of Variation)</li>
<li>BIO16 = Precipitation of Wettest Quarter</li>
<li>BIO17 = Precipitation of Driest Quarter</li>
<li>BIO18 = Precipitation of Warmest Quarter</li>
<li>BIO19 = Precipitation of Coldest Quarter</li>
</ul></li>
</ul>
<div id="downloading-worldclim-data" class="section level4">
<h4>Downloading WorldClim data</h4>
<p>OPTION1: Download the data separately from <a href="https://www.worldclim.org/data/worldclim21.html" class="uri">https://www.worldclim.org/data/worldclim21.html</a>, save it to your Project folder, then read it in using the <code>raster()</code> command.</p>
<p>OPTION2: We can automatically download the data to your computer using <code>raster::getData</code> . You can also download monthly historical weather data or future climate model output - see the getData helpfile for those. I am choosing to just look at the bioclim averages.</p>
<p>Remember to add results = FALSE in your code chunk options</p>
<pre class="r"><code># THIS IS 123 MEGABYTES!  If that is too big for your computer, tell Dr Greatrex and she will subset for you.
worldclim.BIO &lt;- raster::getData(name = &#39;worldclim&#39;, var = &#39;bio&#39;, res = 2.5)</code></pre>
<p>To choose an individual BIO variable (see the list above), we use double [[ ]]</p>
<pre class="r"><code>#------------------------------------------------
# Average annual temp
#------------------------------------------------
worldclim.Annual.Mean.Temperature &lt;- worldclim.BIO$bio1
# For some reason Temperature is  stored in degrees C *10 , so
worldclim.Annual.Mean.Temperature &lt;- worldclim.Annual.Mean.Temperature/10

#------------------------------------------------
# Rain see above for the codes
#----------------------------------------------
worldclim.Annual.Mean.Rain &lt;- worldclim.BIO$bio12</code></pre>
<pre class="r"><code># change the projection of the coastline data to match
coast.world.sf &lt;- st_transform(coast.world.sf,crs(worldclim.Annual.Mean.Rain))

# Tmap hatesr
plot(worldclim.Annual.Mean.Rain,
     col = RColorBrewer::brewer.pal(9, &quot;Blues&quot;),
     main=&quot;Annual total rainfall&quot;)
plot(st_geometry(coast.world.sf),add=TRUE)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-36-1.png" /><!-- --></p>
<pre class="r"><code>plot(worldclim.Annual.Mean.Temperature,
     col = RColorBrewer::brewer.pal(9, &quot;Reds&quot;),
     main=&quot;Historical mean temperature&quot;)
plot(st_geometry(coast.world.sf),add=TRUE)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-36-2.png" /><!-- --></p>
</div>
<div id="adding-worldclim-to-your-datasets" class="section level4">
<h4>Adding WorldClim to your datasets</h4>
<p>This is exactly the same as for your elevation data. Make sure that <code>library(exactextractr)</code> and <code>library(raster)</code> are in your library code chunk at the top.</p>
<p>We can simply use this package to extract the value at our locations - I’m choosing the average over the polygon. To extract</p>
<pre class="r"><code># change projections to match
SVI_county.sf &lt;- st_transform(SVI_county.sf,4326)


# add to polygon data
SVI_county.sf$AnnualRain &lt;- exact_extract(worldclim.Annual.Mean.Rain,
                                          SVI_county.sf,&quot;mean&quot;)

SVI_county.sf$AnnualMean_temp &lt;- exact_extract(worldclim.Annual.Mean.Temperature,
                                               SVI_county.sf,&quot;mean&quot;)

# change projection back
SVI_county.sf &lt;- st_transform(SVI_county.sf,3744)</code></pre>
<p>For point data, we choose simply the extract function.</p>
<pre class="r"><code># change projection
IA_farmersmarket.sf &lt;- st_transform(IA_farmersmarket.sf,4326)


# add to point data
IA_farmersmarket.sf$AnnualRain &lt;- raster::extract(worldclim.Annual.Mean.Rain,
                                                  IA_farmersmarket.sf)


IA_farmersmarket.sf$AnnualMean_temp &lt;- raster::extract(worldclim.Annual.Mean.Temperature,IA_farmersmarket.sf)

# change projection back
IA_farmersmarket.sf &lt;- st_transform(IA_farmersmarket.sf,3744)</code></pre>
<p>Click on the name of your dataset, you will see there is a new column called AnnualRain and AnnualMean_temp. Here is what we have done</p>
<pre class="r"><code># plot 1
map1 &lt;- qtm(SVI_county.sf,&quot;AnnualRain&quot;,fill.palette=&quot;Blues&quot;)+tm_layout(legend.outside = TRUE)

map2 &lt;- qtm(IA_farmersmarket.sf,dots.col=&quot;AnnualRain&quot;,dots.size=.2,dots.palette=&quot;Blues&quot;)+
        tm_shape(border.county.IA.sf)+
             tm_polygons(alpha=0)+
        tm_layout(legend.outside = TRUE)

tmap_arrange(map1,map2)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-39-1.png" /><!-- --></p>
<pre class="r"><code>rm(map1);rm(map2)</code></pre>
<pre class="r"><code># plot 1
map1 &lt;- qtm(SVI_county.sf,&quot;AnnualMean_temp&quot;,fill.palette=&quot;OrRd&quot;)+tm_layout(legend.outside = TRUE)

map2 &lt;- qtm(IA_farmersmarket.sf,dots.col=&quot;AnnualMean_temp&quot;,dots.size=.2,dots.palette=&quot;OrRd&quot;)+
        tm_shape(border.county.IA.sf)+
             tm_polygons(alpha=0)+
        tm_layout(legend.outside = TRUE)

tmap_arrange(map1,map2)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-40-1.png" /><!-- --></p>
<pre class="r"><code>rm(map1);rm(map2)</code></pre>
</div>
</div>
<div id="maximum-windspeed" class="section level3">
<h3>Maximum Windspeed</h3>
<p>You will need to install the <code>rWind</code> package (note the capital W) and the <code>lubridate</code>. Here is a wonderful tutorial</p>
<p><a href="https://www.r-bloggers.com/2018/11/plotting-wind-highways-using-rwind/" class="uri">https://www.r-bloggers.com/2018/11/plotting-wind-highways-using-rwind/</a></p>
<p>Remember to put results=FALSE in the code chunk options.</p>
<pre class="r"><code> library(rWind)  
 library(lubridate)  </code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:raster&#39;:
## 
##     intersect, union</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     date, intersect, setdiff, union</code></pre>
<pre class="r"><code> library(dplyr)  </code></pre>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:raster&#39;:
## 
##     intersect, select, union</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<pre class="r"><code># Here, we use ymd_hms from lubridate package to create a sequence of dates  
# Given this is just a class project, 
# JUST CHOOSE 1 MONTH
startdate &lt;- ymd_hms(paste(2018,6,1,12,00,00, sep=&quot;-&quot;))
enddate &lt;- ymd_hms(paste(2018,6,30,12,00,00, sep=&quot;-&quot;))
TimeSeries &lt;- seq(startdate, enddate,by=&quot;1 days&quot;)  

# This is my box over the Eastern US Coast
Windspeed &lt;- wind.dl_2(TimeSeries,-76,-64,35,45)  

# Tidy the data
tidy_Windspeed &lt;- tidy(Windspeed)  

max_Windspeed &lt;- tidy_Windspeed %&gt;% 
                     dplyr::group_by(lat, lon) %&gt;%
                     dplyr::summarise(speed = max(speed))  </code></pre>
<pre><code>## `summarise()` has grouped output by &#39;lat&#39;. You can override using the `.groups` argument.</code></pre>
<pre class="r"><code>max_Windspeed &lt;- cbind(max_Windspeed$lon, 
                       max_Windspeed$lat, 
                       max_Windspeed$speed)  


max_Windspeed.raster &lt;- rasterFromXYZ(max_Windspeed)  
acol &lt;- colorRampPalette(c(&quot;white&quot;, &quot;blue&quot;, &quot;darkblue&quot;))  

plot(max_Windspeed.raster, col=acol(1000),
     main= &quot;Maximum wind speed reported&quot;,  
     xlab=&quot;Longitude&quot;, ylab=&quot;Lattitude&quot;)  
plot(st_geometry(coast.world.sf),add=TRUE)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-41-1.png" /><!-- --></p>
<p>and let’s extract for our points. I’m just going to make a random set of points</p>
<pre class="r"><code>RandomData &lt;- data.frame(x=rnorm(20,mean=-70,sd=2),
                         y=rnorm(20,mean=40,sd=2))
RandomData.sf &lt;- st_as_sf(RandomData,coords=c(&quot;x&quot;,&quot;y&quot;),crs=4326)


plot(max_Windspeed.raster, col=acol(1000),
     main= &quot;Maximum wind speed reported&quot;,  
     xlab=&quot;Longitude&quot;, ylab=&quot;Lattitude&quot;)  
plot(st_geometry(coast.world.sf),add=TRUE)
plot(st_geometry(RandomData.sf),col=&quot;yellow&quot;,add=TRUE,pch=4,lwd=2)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-42-1.png" /><!-- --></p>
<pre class="r"><code>RandomData.sf$Wind &lt;- raster::extract(max_Windspeed.raster,RandomData.sf)

tmap_mode(&quot;view&quot;)</code></pre>
<pre><code>## tmap mode set to interactive viewing</code></pre>
<pre class="r"><code>qtm(RandomData.sf,dots.col=&quot;Wind&quot;,dots.size=.2)</code></pre>
<div id="htmlwidget-414041d2a14a865f10d5" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-414041d2a14a865f10d5">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"createMapPane","args":["tmap402",402]},{"method":"addProviderTiles","args":["Esri.WorldGrayCanvas",null,"Esri.WorldGrayCanvas",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,"Esri.WorldTopoMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addCircleMarkers","args":[[42.7817527494806,39.614611748761,39.79593185459,38.8472690531456,38.8700206020814,40.1850003134687,42.3263462775548,41.7279991570823,40.0319764647343,41.2014107280709,39.0465542929269,37.4594715545553,39.1542863193397,39.8503798328341,41.2384171785991,39.6625343699718,41.3159158817832,38.2983640771232,40.0948341788979,40.896159867904],[-71.7233239967779,-66.7028283863829,-66.8680867485288,-67.9787041441895,-67.8711318561712,-67.6829797901723,-71.172184940834,-70.3038222641707,-66.7066938601669,-71.1949256822078,-71.6539191252093,-69.6405626904809,-68.4568616527416,-68.9663697401962,-67.7343838938666,-67.6927626923319,-71.2191422840981,-69.1101899114392,-69.8395190475341,-69.6257912961305],[8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916],["X4.86100966594237","X15.2364227430705","X15.8421406926449","X13.5724629660065","X13.5724629660065.1","X15.5769032533927","X4.76932733702314","X10.9165775616881","X15.3796254038782","X11.8471455868191","X13.3710031451434","X13.5064132229231","X12.7183963888384","X12.8150458848086","X14.0452607382546","X14.9621540208493","X7.88528254448288","X12.157192416306","X12.698184027946","X12.0264604229321"],"RandomData.sf",{"interactive":true,"className":"","pane":"tmap401","stroke":true,"color":"#666666","weight":1,"opacity":0.5,"fill":true,"fillColor":["#FFFACE","#A33803","#A33803","#DB5D0A","#DB5D0A","#A33803","#FFFACE","#F88B22","#A33803","#F88B22","#DB5D0A","#DB5D0A","#DB5D0A","#DB5D0A","#A33803","#A33803","#FEE697","#DB5D0A","#DB5D0A","#DB5D0A"],"fillOpacity":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},null,null,["<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>4.86100966594237<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>4.86<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>15.2364227430705<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>15.24<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>15.8421406926449<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>15.84<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>13.5724629660065<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>13.57<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>13.5724629660065<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>13.57<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>15.5769032533927<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>15.58<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>4.76932733702314<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>4.77<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>10.9165775616881<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>10.92<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>15.3796254038782<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>15.38<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>11.8471455868191<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>11.85<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>13.3710031451434<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>13.37<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>13.5064132229231<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>13.51<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>12.7183963888384<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>12.72<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>12.8150458848086<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>12.82<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>14.0452607382546<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>14.05<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>14.9621540208493<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>14.96<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>7.88528254448288<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>7.89<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>12.157192416306<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>12.16<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>12.698184027946<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>12.70<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>12.0264604229321<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>Wind<\/nobr><\/td><td align=\"right\"><nobr>12.03<\/nobr><\/td><\/tr><\/table><\/div>"],null,["4.86100966594237","15.2364227430705","15.8421406926449","13.5724629660065","13.5724629660065","15.5769032533927","4.76932733702314","10.9165775616881","15.3796254038782","11.8471455868191","13.3710031451434","13.5064132229231","12.7183963888384","12.8150458848086","14.0452607382546","14.9621540208493","7.88528254448288","12.157192416306","12.698184027946","12.0264604229321"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#FFFACE","#FEE697","#FEBE4A","#F88B22","#DB5D0A","#A33803"],"labels":["4 to 6","6 to 8","8 to 10","10 to 12","12 to 14","14 to 16"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"unknown","title":"Wind","extra":null,"layerId":"legend401","className":"info legend RandomData.sf","group":"RandomData.sf"}]},{"method":"addLayersControl","args":[["Esri.WorldGrayCanvas","OpenStreetMap","Esri.WorldTopoMap"],"RandomData.sf",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":false,"updateWhenIdle":true,"position":"bottomright"}]}],"limits":{"lat":[37.4594715545553,42.7817527494806],"lng":[-71.7233239967779,-66.7028283863829]},"fitBounds":[37.4594715545553,-71.7233239967779,42.7817527494806,-66.7028283863829,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<div id="additional-data-sources" class="section level4">
<h4>Additional data sources</h4>
<p>there is a great tutorial here I haven’t explored <a href="https://mikejohnson51.github.io/climateR-intro/#98" class="uri">https://mikejohnson51.github.io/climateR-intro/#98</a></p>
</div>
</div>
</div>
<div id="oceans" class="section level2">
<h2>OCEANS</h2>
<div id="coastlines" class="section level3">
<h3>Coastlines</h3>
<p>See borders section</p>
</div>
<div id="windspeed" class="section level3">
<h3>Windspeed</h3>
<p>See weather data section.</p>
</div>
<div id="ocean-floor-depth" class="section level3">
<h3>Ocean floor depth</h3>
<p>A great tutorial here: <a href="https://cran.r-project.org/web/packages/marmap/vignettes/marmap-DataAnalysis.pdf" class="uri">https://cran.r-project.org/web/packages/marmap/vignettes/marmap-DataAnalysis.pdf</a></p>
<p>You will need to install the <code>marmap</code> library. Remember to add results = FALSE in the code chunk options</p>
<pre class="r"><code>library(marmap)</code></pre>
<pre><code>## Registered S3 methods overwritten by &#39;adehabitatMA&#39;:
##   method                       from
##   print.SpatialPixelsDataFrame sp  
##   print.SpatialPixels          sp</code></pre>
<pre><code>## 
## Attaching package: &#39;marmap&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:raster&#39;:
## 
##     as.raster</code></pre>
<pre><code>## The following object is masked from &#39;package:grDevices&#39;:
## 
##     as.raster</code></pre>
<pre class="r"><code># choose your lon/lat box - I chose mine to be just off the Eastern US coastline

oceandepth &lt;- getNOAA.bathy(lon1 = -76, lon2 = -64,
                        lat1 = 35, lat2 = 45, resolution = 10)</code></pre>
<pre><code>## Querying NOAA database ...</code></pre>
<pre><code>## This may take seconds to minutes, depending on grid size</code></pre>
<pre><code>## Building bathy matrix ...</code></pre>
<pre class="r"><code># and plot

par(mfrow=c(1,2))

plot(oceandepth, image=TRUE)

plot(oceandepth, image=TRUE, deep=c(-6000,-300,0), 
                             shallow=c(-300,-10,0), 
                             step=c(500,50,0),
                             lwd=c(0.5,0.5,2), 
                             lty=c(1,2,1),
                             drawlabels=c(TRUE,TRUE,FALSE))</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-45-1.png" /><!-- --></p>
<p>Now let’s extract the values at our point locations. I need some ocean points! I’m going to use the metallo dataset which shows coral samples over the atlantic.</p>
<pre class="r"><code>library(marmap)

# get some data
data(&quot;metallo&quot;)
coraldata &lt;- metallo 
coraldata.sf &lt;- st_as_sf(coraldata,coords=c(&quot;lon&quot;,&quot;lat&quot;))

# make a box a little bigger than our area. There are more elegant ways of doing this.
lon1 &lt;- sign(extent(coraldata.sf)@xmin)*abs(extent(coraldata.sf)@xmin)-1
lon2 &lt;- sign(extent(coraldata.sf)@xmax)*abs(extent(coraldata.sf)@xmax)+1
lat1 &lt;- sign(extent(coraldata.sf)@ymin)*abs(extent(coraldata.sf)@ymin)-1
lat2 &lt;- sign(extent(coraldata.sf)@ymax)*abs(extent(coraldata.sf)@ymax)+1

oceandepth_coral &lt;- getNOAA.bathy(lon1, lon2, lat1, lat2, resolution = 10)</code></pre>
<pre><code>## Querying NOAA database ...</code></pre>
<pre><code>## This may take seconds to minutes, depending on grid size</code></pre>
<pre><code>## Building bathy matrix ...</code></pre>
<pre class="r"><code>oceandepth_coral.raster &lt;- as.raster(oceandepth_coral)

coraldata.sf$OceanDepth &lt;- raster::extract(oceandepth_coral.raster,coraldata.sf)


# and plot

map1 &lt;- tm_shape(oceandepth_coral.raster)+tm_raster(palette=&quot;Blues&quot;) +
  tm_shape(coraldata.sf)+tm_dots(size=.2)

map2 &lt;- qtm(coraldata.sf,dots.col=&quot;OceanDepth&quot;,dots.palette=&quot;Blues&quot;,dots.size=.2)

tmap_mode(&quot;plot&quot;)</code></pre>
<pre><code>## tmap mode set to plotting</code></pre>
<pre class="r"><code>tmap_arrange(map1,map2)</code></pre>
<pre><code>## Warning: Currect projection of shape coraldata.sf unknown. Long-lat (WGS84) is
## assumed.

## Warning: Currect projection of shape coraldata.sf unknown. Long-lat (WGS84) is
## assumed.

## Warning: Currect projection of shape coraldata.sf unknown. Long-lat (WGS84) is
## assumed.

## Warning: Currect projection of shape coraldata.sf unknown. Long-lat (WGS84) is
## assumed.</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-46-1.png" /><!-- --></p>
<pre class="r"><code>rm(map1);rm(map2)</code></pre>
</div>
<div id="sea-surface-temperature-raw" class="section level3">
<h3>Sea Surface Temperature Raw</h3>
<p>Here’s the tutorial. Happy to help folks work through it in labs</p>
<p><a href="https://hansenjohnson.org/post/sst-in-r/" class="uri">https://hansenjohnson.org/post/sst-in-r/</a></p>
</div>
<div id="sea-surface-temperature-change" class="section level3">
<h3>Sea Surface Temperature CHANGE</h3>
<p>Go here and download this dataset (the .nc file) into your project folder <a href="https://psl.noaa.gov/data/gridded/data.kaplan_sst.html" class="uri">https://psl.noaa.gov/data/gridded/data.kaplan_sst.html</a>.</p>
<p>This is a netcdf file and we can read it in using the raster package and the stack command, It contains the anomaly (e.g. colder/hotter than average for each historical month)</p>
<pre class="r"><code># rotate shifts the long from 0-360 to -180:180
SST_anom &lt;- rotate(stack(&quot;sst.mon.anom.nc&quot;))

# change the coastline data (downloaded in borders) to have the same projection
coast.world.sf &lt;- st_transform(coast.world.sf,crs(SST_anom))

#For example make a plot
layer &lt;- 2

plot(SST_anom[[layer]],zlim=c(-2,2),
     col = rev(RColorBrewer::brewer.pal(9, &quot;RdBu&quot;)),
     main=names(SST_anom[[layer]]))
plot(st_geometry(coast.world.sf),add=TRUE)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-47-1.png" /><!-- --></p>
<p>But we want the average change, so we take the mean</p>
<pre class="r"><code>meanSST.Change &lt;- mean(SST_anom)


plot(meanSST.Change,zlim=c(-.5,.5),
     col = rev(RColorBrewer::brewer.pal(9, &quot;PiYG&quot;)),
     main=&quot;Mean SST change&quot;)
plot(st_geometry(coast.world.sf),add=TRUE)</code></pre>
<p><img src="364Data_TutorialDownload_files/figure-html/unnamed-chunk-48-1.png" /><!-- --></p>
<p>and let’s extract for our coral points</p>
<pre class="r"><code>coraldata.sf$SSTChange &lt;- raster::extract(meanSST.Change,coraldata.sf)

tmap_mode(&quot;view&quot;)</code></pre>
<pre><code>## tmap mode set to interactive viewing</code></pre>
<pre class="r"><code>qtm(coraldata.sf,dots.col=&quot;SSTChange&quot;,dots.size=.2,dots.palette=&quot;PiYG&quot;)</code></pre>
<pre><code>## Warning: Currect projection of shape coraldata.sf unknown. Long-lat (WGS84) is
## assumed.</code></pre>
<pre><code>## Variable(s) &quot;SSTChange&quot; contains positive and negative values, so midpoint is set to 0. Set midpoint = NA to show the full spectrum of the color palette.</code></pre>
<div id="htmlwidget-2c8c6572fbdd2fb4ff1c" style="width:672px;height:480px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-2c8c6572fbdd2fb4ff1c">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"createMapPane","args":["tmap402",402]},{"method":"addProviderTiles","args":["Esri.WorldGrayCanvas",null,"Esri.WorldGrayCanvas",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldTopoMap",null,"Esri.WorldTopoMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addCircleMarkers","args":[[33.7534,34.4802,34.4802,34.5345,34.5435,34.8153,35.1938,35.3935,35.5568,37.4605,38.1348,38.1348,38.1415,38.1463,38.1488,38.2245,38.2632,38.7885,38.7887,38.82,38.82,38.8529,38.8529,38.8529,38.8536,38.8553,38.86,39.3551,39.3551,39.3585,39.3585,39.3585,39.3716,39.6487,39.8079,39.8097,39.8815,39.9517],[-62.5849,-56.7358,-56.7358,-49.7932,-49.7925,-50.5058,-47.6767,-51.2655,-51.8148,-59.9513,-61.1161,-61.1161,-61.0878,-61.1153,-61.1022,-60.474,-60.5502,-64.1304,-64.1318,-63.959,-63.959,-63.7643,-63.7643,-63.7643,-63.7642,-63.7692,-63.9142,-65.3586,-65.3586,-65.3636,-65.3636,-65.3636,-65.3718,-65.9259,-66.25,-66.2492,-67.4735,-67.413],[8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916,8.94427190999916],["X2263","X2103","X2103.1","X2038","X1541","X1601","X2143","X2135","X1830","X1907","X1718","X1718.1","X1440","X1668","X1847","X1421","X1735","X1949","X2029","X1773","X1773.1","X2078","X2078.1","X2078.2","X2054","X1996","X2173","X1914","X1914.1","X1767","X1767.1","X1767.2","X1562","X2085","X2012","X1983","X1639","X1559"],"coraldata.sf",{"interactive":true,"className":"","pane":"tmap401","stroke":true,"color":"#666666","weight":1,"opacity":0.5,"fill":true,"fillColor":["#FBE6F1","#FBE6F1","#FBE6F1","#EBF5DB","#EBF5DB","#EBF5DB","#5C9E2A","#ACD978","#ACD978","#EBF5DB","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#FBE6F1","#E389BB","#E389BB","#E389BB","#E389BB","#E389BB","#E389BB","#E389BB","#E389BB","#E389BB","#E389BB","#E389BB"],"fillOpacity":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]},null,null,["<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2263<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.027<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2103<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.003<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2103<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.003<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2038<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>0.049<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1541<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>0.049<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1601<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>0.023<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2143<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>0.134<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2135<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>0.097<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1830<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>0.097<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1907<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>0.034<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1718<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1718<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1440<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1668<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1847<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1421<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1735<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1949<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2029<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1773<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1773<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2078<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2078<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2078<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2054<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1996<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2173<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.041<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1914<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1914<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1767<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1767<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1767<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1562<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2085<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>2012<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1983<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1639<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>","<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1559<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>SSTChange<\/nobr><\/td><td align=\"right\"><nobr>-0.078<\/nobr><\/td><\/tr><\/table><\/div>"],null,["2263","2103","2103","2038","1541","1601","2143","2135","1830","1907","1718","1718","1440","1668","1847","1421","1735","1949","2029","1773","1773","2078","2078","2078","2054","1996","2173","1914","1914","1767","1767","1767","1562","2085","2012","1983","1639","1559"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLegend","args":[{"colors":["#E389BB","#FBE6F1","#EBF5DB","#ACD978","#5C9E2A"],"labels":["-0.10 to -0.05","-0.05 to 0.00","0.00 to 0.05","0.05 to 0.10","0.10 to 0.15"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"unknown","title":"SSTChange","extra":null,"layerId":"legend401","className":"info legend coraldata.sf","group":"coraldata.sf"}]},{"method":"addLayersControl","args":[["Esri.WorldGrayCanvas","OpenStreetMap","Esri.WorldTopoMap"],"coraldata.sf",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":false,"updateWhenIdle":true,"position":"bottomright"}]}],"limits":{"lat":[33.7534,39.9517],"lng":[-67.4735,-47.6767]},"fitBounds":[33.7534,-67.4735,39.9517,-47.6767,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>


</body>
</html>
